<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espace Client - Service de Réservation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-dark: #3a56d4;
            --primary-light: #eef2ff;
            --secondary-color: #f8f9fa;
            --dark-color: #1e293b;
            --light-color: #ffffff;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --success-color: #10b981;
            --border-color: #e2e8f0;
            --text-color: #334155;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f3 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Cercles décoratifs en arrière-plan */
        .bg-circles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
            top: 0;
            left: 0;
        }
        
        .circle {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(to right, rgba(67, 97, 238, 0.1), rgba(58, 86, 212, 0.05));
            animation: float 15s infinite ease-in-out;
        }
        
        .circle-1 {
            width: 300px;
            height: 300px;
            top: -100px;
            left: -100px;
            animation-delay: 0s;
        }
        
        .circle-2 {
            width: 500px;
            height: 500px;
            bottom: -200px;
            right: -200px;
            animation-delay: 2s;
        }
        
        .circle-3 {
            width: 200px;
            height: 200px;
            top: 30%;
            right: 10%;
            animation-delay: 4s;
        }
        
        .circle-4 {
            width: 150px;
            height: 150px;
            top: 40%;
            left: 15%;
            background: linear-gradient(to right, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            animation-delay: 6s;
            animation-duration: 17s;
        }
        
        .circle-5 {
            width: 100px;
            height: 100px;
            bottom: 20%;
            left: 30%;
            background: linear-gradient(to right, rgba(239, 68, 68, 0.05), rgba(239, 68, 68, 0.02));
            animation-delay: 1s;
            animation-duration: 13s;
        }
        
        .circle-6 {
            width: 250px;
            height: 250px;
            top: 10%;
            left: 40%;
            background: linear-gradient(to right, rgba(245, 158, 11, 0.05), rgba(245, 158, 11, 0.02));
            animation-delay: 3s;
            animation-duration: 20s;
        }
        
        .circle-7 {
            width: 180px;
            height: 180px;
            bottom: 30%;
            right: 25%;
            background: linear-gradient(to right, rgba(59, 130, 246, 0.05), rgba(59, 130, 246, 0.02));
            animation-delay: 5s;
            animation-duration: 18s;
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(5deg);
            }
        }
        
        /* Particules décoratifs */
        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: -1;
            top: 0;
            left: 0;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: rgba(67, 97, 238, 0.1);
            border-radius: 50%;
            animation: particleFloat 20s infinite linear;
        }
        
        @keyframes particleFloat {
            0% {
                transform: translate(0, 0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translate(var(--x), var(--y));
                opacity: 0;
            }
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: var(--light-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -10%;
            width: 120%;
            height: 200%;
            background: radial-gradient(ellipse at center, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0) 60%);
            animation: pulse 8s infinite ease-in-out;
            z-index: -1;
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.2;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.3;
            }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
            position: relative;
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--light-color);
            display: flex;
            align-items: center;
            text-decoration: none;
            transition: transform 0.3s ease;
        }
        
        .logo:hover {
            transform: translateY(-3px);
        }
        
        .logo i {
            margin-right: 0.75rem;
            color: var(--light-color);
            font-size: 1.75rem;
            animation: logoSpin 10s infinite linear;
            display: inline-block;
        }
        
        @keyframes logoSpin {
            0% {
                transform: rotate(0deg);
            }
            25% {
                transform: rotate(10deg);
            }
            75% {
                transform: rotate(-10deg);
            }
            100% {
                transform: rotate(0deg);
            }
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-name {
            margin-right: 1.25rem;
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        
        .user-name i {
            margin-right: 0.75rem;
            color: var(--light-color);
            background-color: rgba(255, 255, 255, 0.2);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .user-name:hover i {
            transform: scale(1.1);
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        /* Button Styles */
        .btn {
            display: inline-flex;
            padding: 0.625rem 1.25rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-decoration: none;
            border: none;
            font-size: 0.9rem;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-weight: 500;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .btn i {
            font-size: 0.9rem;
            transition: transform 0.3s ease;
        }
        
        .btn:hover i {
            transform: translateX(2px);
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }
        
        .btn:hover::after {
            width: 300px;
            height: 300px;
        }
        
        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.8rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: var(--light-color);
            box-shadow: 0 4px 6px rgba(67, 97, 238, 0.2);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-color) 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn-outline {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            box-shadow: 0 2px 4px rgba(67, 97, 238, 0.1);
        }
        
        .btn-outline:hover {
            background-color: var(--primary-light);
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(67, 97, 238, 0.2);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%);
            color: var(--light-color);
            box-shadow: 0 4px 6px rgba(239, 68, 68, 0.2);
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626 0%, var(--danger-color) 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(239, 68, 68, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, #d97706 100%);
            color: var(--light-color);
            box-shadow: 0 4px 6px rgba(245, 158, 11, 0.2);
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #d97706 0%, var(--warning-color) 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(245, 158, 11, 0.3);
        }
        
        .btn-info {
            background: linear-gradient(135deg, var(--info-color) 0%, #2563eb 100%);
            color: var(--light-color);
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.2);
        }
        
        .btn-info:hover {
            background: linear-gradient(135deg, #2563eb 0%, var(--info-color) 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(59, 130, 246, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #059669 100%);
            color: var(--light-color);
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.2);
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, var(--success-color) 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(16, 185, 129, 0.3);
        }
        
        /* Dashboard Layout */
        .dashboard {
            display: flex;
            margin: 1.5rem 0;
            gap: 1.5rem;
            position: relative;
            z-index: 1;
        }
        
        .sidebar {
            width: 280px;
            background-color: var(--light-color);
            border-radius: 1rem;
            box-shadow: var(--shadow);
            padding: 1.75rem;
            height: calc(100vh - 100px);
            position: sticky;
            top: 90px;
            overflow-y: auto;
            animation: sidebarIn 0.5s ease-out;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        @keyframes sidebarIn {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .sidebar:hover {
            box-shadow: var(--shadow-lg);
            transform: translateX(5px);
        }
        
        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .sidebar-header i {
            font-size: 1.5rem;
            margin-right: 0.75rem;
            color: var(--primary-color);
            transition: transform 0.3s ease;
        }
        
        .sidebar:hover .sidebar-header i {
            transform: rotate(15deg);
        }
        
        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark-color);
            position: relative;
        }
        
        .sidebar-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }
        
        .sidebar:hover .sidebar-title::after {
            width: 100%;
        }
        
        .sidebar-menu {
            list-style-type: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 0.5rem;
            transition: transform 0.3s ease;
        }
        
        .sidebar-menu li:hover {
            transform: translateX(5px);
        }
        
        .sidebar-menu li a {
            display: flex;
            align-items: center;
            padding: 0.875rem 1.25rem;
            text-decoration: none;
            color: var(--text-color);
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .sidebar-menu li a i {
            margin-right: 0.75rem;
            width: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .sidebar-menu li a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(67, 97, 238, 0.1), transparent);
            transition: all 0.5s ease;
        }
        
        .sidebar-menu li a:hover::before {
            left: 100%;
        }
        
        .sidebar-menu li a:hover,
        .sidebar-menu li a.active {
            background-color: var(--primary-light);
            color: var(--primary-color);
        }
        
        .sidebar-menu li a:hover i,
        .sidebar-menu li a.active i {
            transform: scale(1.2);
        }
        
        .main-content {
            flex: 1;
            background-color: var(--light-color);
            border-radius: 1rem;
            box-shadow: var(--shadow);
            padding: 1.75rem;
            min-height: calc(100vh - 100px);
            animation: fadeIn 0.5s ease-out;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .main-content:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-5px);
        }
        
        .section-title {
            margin-bottom: 1.75rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), transparent);
            transition: width 0.3s ease;
        }
        
        .section-title:hover::after {
            width: 100px;
        }
        
        .section-title h2 {
            font-size: 1.5rem;
            color: var(--dark-color);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
        }
        
        .section-title h2 i {
            color: var(--primary-color);
            animation: iconPulse 2s infinite ease-in-out;
        }
        
        @keyframes iconPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
        
        /* Search and filter controls */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.75rem;
            flex-wrap: wrap;
            gap: 1rem;
            transition: transform 0.3s ease;
        }
        
        .controls:hover {
            transform: translateY(-3px);
        }
        
        .search-container {
            flex: 1;
            min-width: 250px;
            display: flex;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 0.875rem;
            padding-left: 2.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15), 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: var(--light-color);
            transform: translateY(-2px);
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            transition: all 0.3s ease;
        }
        
        .search-input:focus + .search-icon {
            color: var(--primary-color);
            transform: translateY(-50%) scale(1.1);
        }
        
        .filters {
            display: flex;
            gap: 1rem;
        }
        
        .filter-select {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            background-color: rgba(255, 255, 255, 0.8);
            font-family: 'Poppins', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            background-image: linear-gradient(to bottom, var(--light-color), #f8f9fa);
        }
        
        .filter-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15), 0 4px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .filter-select:hover {
            border-color: var(--primary-color);
            background-image: linear-gradient(to bottom, #f8f9fa, var(--light-color));
        }
        /* Cards Grid Styles */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.75rem;
            margin-bottom: 1.75rem;
        }
        
        .agency-card {
            display: flex;
            flex-direction: column;
            height: 100%;
            background-color: white;
            border-radius: 1rem;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        .agency-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s ease;
        }
        
        .agency-card:hover::before {
            transform: scaleX(1);
        }
        
        .agency-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
            z-index: 2;
        }
        
        /* En-tête de carte */
        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
        }
        
        .card-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            flex-shrink: 0;
        }
        
        .card-avatar i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .card-title-container {
            flex: 1;
        }
        
        .card-title {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .card-subtitle {
            font-size: 0.9rem;
            color: #64748b;
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Corps de la carte */
        .card-body {
            flex: 1;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
        }
        
        .card-details {
            margin-bottom: 1.25rem;
        }
        
        .card-detail {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.875rem;
        }
        
        .card-detail i {
            width: 20px;
            margin-right: 0.875rem;
            color: #64748b;
            text-align: center;
            margin-top: 0.25rem;
            flex-shrink: 0;
        }
        
        .detail-value {
            flex: 1;
            word-break: break-word;
        }
        
        .card-services {
            margin-top: auto;
            border-top: 1px solid var(--border-color);
            padding-top: 1.25rem;
        }
        
        .services-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .services-title i {
            color: var(--primary-color);
        }
        
        .services-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.625rem;
        }
        
        .service-item {
            background-color: var(--primary-light);
            color: var(--primary-color);
            padding: 0.375rem 0.875rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        /* Pied de carte */
        .card-footer {
            display: flex;
            justify-content: space-between;
            padding: 1.25rem;
            border-top: 1px solid var(--border-color);
            background-color: #f8f9fa;
        }
        
        .hours-open {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
            color: #64748b;
            gap: 0.5rem;
        }
        
        .hours-open i {
            color: var(--primary-color);
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .form-control {
            width: 100%;
            padding: 0.875rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.95rem;
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }
        
        select.form-control {
            background-color: white;
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-row {
            display: flex;
            gap: 1.25rem;
            margin-bottom: 1.5rem;
        }
        
        .form-col {
            flex: 1;
        }
        
        /* Reservation form */
        .reservation-form {
            background-color: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }
        
        .reservation-agency {
            display: flex;
            align-items: center;
            margin-bottom: 1.75rem;
            padding-bottom: 1.25rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .agency-logo {
            width: 64px;
            height: 64px;
            background-color: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1.25rem;
            color: var(--primary-color);
            font-size: 1.75rem;
            flex-shrink: 0;
        }
        
        .agency-info h3 {
            margin: 0 0 0.5rem 0;
            font-weight: 600;
        }
        
        .agency-info p {
            margin: 0;
            color: #64748b;
            font-size: 0.95rem;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        /* Availability Calendar Styles */
        .date-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }

        .current-week-label {
            font-weight: 600;
            color: var(--primary-color);
        }

        .availability-calendar {
            background-color: white;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            margin-bottom: 1.75rem;
            border: 1px solid var(--border-color);
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background-color: var(--primary-light);
            border-bottom: 1px solid var(--border-color);
        }

        .calendar-day {
            text-align: center;
            padding: 0.875rem 0.5rem;
            font-weight: 600;
            position: relative;
        }

        .calendar-day.today {
            background-color: var(--primary-color);
            color: white;
        }

        .calendar-day .day-name {
            display: block;
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
        }

        .calendar-day .day-date {
            display: block;
            font-size: 1.1rem;
            margin-top: 0.25rem;
        }

        .calendar-day.today .day-name,
        .calendar-day.today .day-date {
            color: white;
        }

        .calendar-slots {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: var(--border-color);
            padding: 1px;
        }

        .day-slots {
            display: flex;
            flex-direction: column;
            gap: 1px;
            background-color: var(--border-color);
        }

        .time-slot {
            padding: 0.625rem;
            text-align: center;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
        }

        .time-slot:hover {
            background-color: var(--primary-light);
        }

        .time-slot.available {
            background-color: #e9f7ef;
        }

        .time-slot.available:hover {
            background-color: #c8e6c9;
        }

        .time-slot.booked {
            background-color: #ffebee;
            cursor: not-allowed;
            color: #999;
        }

        .time-slot.selected {
            background-color: var(--primary-color);
            color: white;
        }

        .time-slot.selected:hover {
            background-color: var(--primary-dark);
        }

        .time-slot.no-slots {
            background-color: #f8f9fa;
            cursor: default;
            color: #999;
            padding: 1.25rem;
            font-style: italic;
        }

        /* Styles pour les créneaux passés */
        .time-slot.past-slot {
            background-color: #f2f2f2;
            color: #999;
            text-decoration: line-through;
            cursor: not-allowed;
        }

        .calendar-day.past-date {
            background-color: #f8f9fa;
            color: #999;
        }

        .time-slot.past-date-message {
            background-color: #f8f9fa;
            color: #999;
            font-style: italic;
            padding: 1.5rem;
            text-align: center;
        }

        /* Message informatif pour la limite de réservation */
        .reservation-info {
            background-color: #e9f5fe;
            border-left: 4px solid var(--info-color);
            padding: 1.25rem;
            margin-bottom: 1.75rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: flex-start;
            gap: 0.875rem;
        }

        .reservation-info i {
            color: var(--info-color);
            font-size: 1.25rem;
            margin-top: 0.1rem;
            flex-shrink: 0;
        }

        /* Notification pour une réservation active existante */
        .reservation-active-warning {
            background-color: #fef3c7;
            border-left: 4px solid var(--warning-color);
            padding: 1.25rem;
            margin-bottom: 1.75rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: flex-start;
            gap: 0.875rem;
        }

        .reservation-active-warning i {
            color: var(--warning-color);
            font-size: 1.25rem;
            margin-top: 0.1rem;
            flex-shrink: 0;
        }

        .selected-time-display {
            padding: 0.875rem;
            background-color: var(--primary-light);
            border-radius: 0.5rem;
            margin-top: 1.25rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .selected-time-display i {
            color: var(--primary-color);
        }

        .loading {
            text-align: center;
            padding: 2rem;
            grid-column: 1 / -1;
            color: #64748b;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        
        .loading i {
            font-size: 2rem;
            color: var(--primary-color);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            text-align: center;
            padding: 1.5rem;
            grid-column: 1 / -1;
            color: var(--danger-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }
        
        .error i {
            font-size: 2rem;
        }
        
        /* Reservation history */
        .reservation-history {
            background-color: white;
            border-radius: 1rem;
            padding: 1.5rem;
        }
        
        .reservation-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        
        .reservation-item {
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            background-color: white;
        }
        
        .reservation-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
            border-color: var(--primary-light);
        }
        
        .reservation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            padding-bottom: 0.875rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .reservation-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .reservation-title i {
            color: var(--primary-color);
        }
        
        .reservation-status {
            display: inline-flex;
            align-items: center;
            padding: 0.375rem 0.875rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            gap: 0.5rem;
        }
        
        .status-pending {
            background-color: #fff8e1;
            color: #ed8936;
        }
        
        .status-pending i {
            color: #ed8936;
        }
        
        .status-confirmed {
            background-color: #e9f7ef;
            color: #38a169;
        }
        
        .status-confirmed i {
            color: #38a169;
        }
        
        .status-canceled {
            background-color: #fff5f5;
            color: #e53e3e;
        }
        
        .status-canceled i {
            color: #e53e3e;
        }
        
        .status-completed {
            background-color: #ebf8ff;
            color: #3182ce;
        }
        
        .status-completed i {
            color: #3182ce;
        }
        
        .reservation-details {
            margin-bottom: 1.25rem;
        }
        
        .reservation-detail {
            display: flex;
            margin-bottom: 0.75rem;
        }
        
        .detail-label {
            width: 140px;
            font-weight: 600;
            color: #64748b;
            flex-shrink: 0;
        }
        
        .detail-value {
            flex: 1;
        }
        
        .reservation-description {
            background-color: #f8f9fa;
            padding: 1.25rem;
            border-radius: 0.5rem;
            margin-bottom: 1.25rem;
            font-style: italic;
            color: #4b5563;
        }
        
        /* Feedback Button and Modal */
        .add-feedback-btn {
            margin-top: 1rem;
        }
        
        .star-rating {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .star-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: #cbd5e0;
            padding: 0;
            transition: color 0.2s;
        }
        
        .star-btn.active {
            color: #f59e0b;
        }
        
        .star-btn:hover {
            color: #f59e0b;
        }
        
        /* Profile Section */
        .profile-card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        
        .profile-header {
            background-color: var(--primary-light);
            padding: 2.5rem 2rem;
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .profile-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top right, rgba(67, 97, 238, 0.1), transparent 60%);
            z-index: 0;
        }
        
        .profile-avatar {
            width: 110px;
            height: 110px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 2rem;
            font-size: 3rem;
            color: var(--primary-color);
            box-shadow: var(--shadow);
            position: relative;
            z-index: 1;
            flex-shrink: 0;
        }
        
        .profile-info {
            position: relative;
            z-index: 1;
        }
        
        .profile-info h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1.75rem;
            color: var(--dark-color);
        }
        
        .profile-info p {
            margin: 0;
            color: #4b5563;
            font-size: 1.1rem;
        }
        
        .profile-stats {
            display: flex;
            gap: 2rem;
            margin-top: 1.25rem;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: var(--shadow-sm);
            min-width: 100px;
        }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #4b5563;
            font-weight: 500;
        }
        
        .profile-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            background-color: #f8f9fa;
        }
        
        .profile-tab {
            padding: 1.25rem 1.5rem;
            cursor: pointer;
            font-weight: 500;
            color: #64748b;
            transition: var(--transition);
            border-bottom: 2px solid transparent;
        }
        
        .profile-tab:hover {
            color: var(--primary-color);
        }
        
        .profile-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background-color: white;
        }
        
        .profile-content {
            padding: 1.75rem;
        }
        
        .profile-section {
            display: none;
        }
        
        .profile-section.active {
            display: block;
        }
        
        .profile-data {
            margin-bottom: 2rem;
        }
        
        .profile-data-item {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #f0f0f0;
            gap: 1rem;
        }
        
        .profile-data-item:last-child {
            border-bottom: none;
        }
        
        .profile-data-item i {
            width: 40px;
            height: 40px;
            background-color: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            flex-shrink: 0;
        }
        
        .profile-label {
            width: 140px;
            font-weight: 600;
            color: #64748b;
            flex-shrink: 0;
        }
        
        .profile-value {
            flex: 1;
        }
        
        /* Help Section */
        .help-card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: var(--shadow);
            padding: 1.75rem;
            margin-bottom: 1.75rem;
            border: 1px solid var(--border-color);
        }
        
        .faq-item {
            margin-bottom: 1.75rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1.75rem;
        }
        
        .faq-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .faq-question {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.1rem;
        }
        
        .faq-question i {
            color: var(--primary-color);
        }
        
        .faq-answer {
            margin-left: 2.25rem;
            color: #4b5563;
            line-height: 1.7;
        }
        
        .help-contact {
            background-color: var(--primary-light);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid rgba(67, 97, 238, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .help-contact::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(67, 97, 238, 0.1), transparent 70%);
            z-index: 0;
        }
        
        .help-contact h3 {
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            z-index: 1;
        }
        
        .help-contact h3 i {
            color: var(--primary-color);
        }
        
        /* Alert Styles */
        .alert {
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.75rem;
            border: 1px solid transparent;
            border-radius: 0.5rem;
            position: relative;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .alert i {
            font-size: 1.25rem;
            flex-shrink: 0;
            margin-top: 0.125rem;
        }
        
        .alert-success {
            color: #0f766e;
            background-color: #d1fae5;
            border-color: #a7f3d0;
        }
        
        .alert-success i {
            color: #059669;
        }
        
        .alert-danger {
            color: #b91c1c;
            background-color: #fee2e2;
            border-color: #fecaca;
        }
        
        .alert-danger i {
            color: #dc2626;
        }
        
        .alert-warning {
            color: #b45309;
            background-color: #fef3c7;
            border-color: #fde68a;
        }
        
        .alert-warning i {
            color: #d97706;
        }
        
        .alert-info {
            color: #1e40af;
            background-color: #e0f2fe;
            border-color: #bae6fd;
        }
        
        .alert-info i {
            color: #3b82f6;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
            padding: 2rem 0;
        }
        
        .modal-dialog {
            max-width: 600px;
            margin: 0 auto;
            background-color: var(--light-color);
            border-radius: 1rem;
            box-shadow: var(--shadow-lg);
            animation: modalOpen 0.3s ease-out;
        }
        
        @keyframes modalOpen {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--primary-color);
            color: white;
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
        }
        
        .modal-title {
            margin: 0;
            font-size: 1.25rem;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .modal-body {
            padding: 1.75rem;
        }
        
        .modal-footer {
            padding: 1.25rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            background-color: #f8f9fa;
            border-bottom-left-radius: 1rem;
            border-bottom-right-radius: 1rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        
        .close-modal:hover {
            opacity: 1;
        }
        
        /* Success Modal */
        .success-modal .modal-header {
            background-color: var(--success-color);
        }
        
        .success-checkmark {
            text-align: center;
            margin: 1rem 0 2rem;
        }
        
        .success-checkmark i {
            font-size: 4rem;
            color: var(--success-color);
            animation: checkmark 0.5s ease-in-out;
        }
        
        @keyframes checkmark {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .success-message {
            text-align: center;
            color: #4b5563;
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        /* Feedback Modal */
        .feedback-modal .modal-header {
            background-color: var(--primary-color);
        }
        
        /* Loader Styles */
        .loader {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2.5rem;
            flex-direction: column;
            gap: 1.25rem;
        }
        
        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid rgba(67, 97, 238, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* No results */
        .no-results {
            text-align: center;
            padding: 4rem 0;
            color: #64748b;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.25rem;
        }
        
        .no-results i {
            font-size: 3.5rem;
            color: #cbd5e0;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            list-style-type: none;
            gap: 0.5rem;
            margin-top: 1.75rem;
        }
        
        .page-item {
            display: flex;
        }
        
        .page-link {
            padding: 0.625rem 0.875rem;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            text-decoration: none;
            border-radius: 0.5rem;
            transition: var(--transition);
            font-weight: 500;
        }
        
        .page-link:hover {
            background-color: #f8f9fa;
            border-color: var(--primary-color);
        }
        
        .page-item.active .page-link {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* Feedback Badge */
        .feedback-badge {
            display: inline-flex;
            align-items: center;
            background-color: #e9f7ef;
            color: #16a34a;
            padding: 0.375rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }
        
        /* Utilities */
        .hidden {
            display: none !important;
        }
        
        .text-right {
            text-align: right;
        }
        
        .mt-2 {
            margin-top: 1rem;
        }
        
        .mt-4 {
            margin-top: 2rem;
        }
        
        .mb-2 {
            margin-bottom: 1rem;
        }
        
        .mb-4 {
            margin-bottom: 2rem;
        }
        
        /* Responsive Adjustments */
        @media (max-width: 1200px) {
            .cards-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
            
            .profile-stats {
                gap: 1rem;
            }
            
            .stat-item {
                padding: 0.5rem 1rem;
            }
        }
        
        @media (max-width: 992px) {
            .dashboard {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: static;
                margin-right: 0;
                margin-bottom: 1.5rem;
            }
            
            .sidebar-menu {
                display: flex;
                flex-wrap: wrap;
                gap: 0.75rem;
            }
            
            .sidebar-menu li {
                flex: 1;
                min-width: 200px;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-avatar {
                margin-right: 0;
                margin-bottom: 1.5rem;
            }
            
            .profile-stats {
                justify-content: center;
            }
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .calendar-days, .calendar-slots {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .calendar-day, .day-slots {
                min-height: 60px;
            }
            
            .calendar-day .day-name {
                font-size: 0.75rem;
            }
            
            .calendar-day .day-date {
                font-size: 0.9rem;
            }
            
            .date-navigation {
                flex-direction: column;
                gap: 0.75rem;
                align-items: stretch;
            }
            
            .current-week-label {
                order: -1;
                text-align: center;
                margin-bottom: 0.5rem;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .form-actions .btn {
                width: 100%;
            }
            
            .reservation-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
            
            .profile-tabs {
                flex-wrap: wrap;
            }
            
            .profile-tab {
                flex: 1;
                text-align: center;
                padding: 0.75rem 0.5rem;
                font-size: 0.9rem;
            }
            
            .profile-data-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .profile-label {
                width: 100%;
            }
            
            .stat-item {
                min-width: 80px;
            }
        }
        
        @media (max-width: 480px) {
            .user-name span {
                display: none;
            }
            
            .profile-stats {
                flex-wrap: wrap;
            }
            
            .stat-item {
                min-width: 40%;
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="bg-circles">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
        <div class="circle circle-3"></div>
        <div class="circle circle-4"></div>
        <div class="circle circle-5"></div>
        <div class="circle circle-6"></div>
        <div class="circle circle-7"></div>
    </div>
    
    <div class="particles" id="particles"></div>

    <header>
        <div class="container header-container">
            <a href="index.html" class="logo">
                <i class="fas fa-calendar-check"></i>
                <span>Service de Réservation</span>
            </a>
            <div class="user-info">
                <span class="user-name">
                    <i class="fas fa-user-circle"></i>
                    <span id="username">Utilisateur</span>
                </span>
                <button id="logoutBtn" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> Déconnexion
                </button>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="dashboard">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <i class="fas fa-th-large"></i>
                    <h3 class="sidebar-title">Tableau de bord</h3>
                </div>
                <ul class="sidebar-menu">
                    <li>
                        <a href="#" class="active" data-section="agencies-section">
                            <i class="fas fa-building"></i> Nos agences
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="reservation-history-section">
                            <i class="fas fa-history"></i> Mes réservations
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="profile-section">
                            <i class="fas fa-user"></i> Mon profil
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="help-section">
                            <i class="fas fa-question-circle"></i> Aide & support
                        </a>
                    </li>
                </ul>
            </aside>
            
            <main class="main-content">
                <!-- Section Agences -->
                <section id="agencies-section">
                    <div class="section-title">
                        <h2><i class="fas fa-building"></i> Nos agences</h2>
                    </div>
                    
                    <div id="alertContainer"></div>
                    
                    <div class="controls">
                        <div class="search-container">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="searchInput" class="search-input" placeholder="Rechercher par nom d'agence ou ville...">
                        </div>
                        <div class="filters">
                            <select id="cityFilter" class="filter-select">
                                <option value="">Toutes les villes</option>
                            </select>
                            <select id="serviceFilter" class="filter-select">
                                <option value="">Tous les services</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="agenciesLoader" class="loader">
                        <div class="spinner"></div>
                        <p>Chargement des agences...</p>
                    </div>
                    
                    <div id="noAgencies" class="no-results hidden">
                        <i class="fas fa-building"></i>
                        <p>Aucune agence trouvée.</p>
                    </div>
                    
                    <div id="agenciesGrid" class="cards-grid"></div>
                </section>
                
                <!-- Section Formulaire de Réservation -->
                <section id="reservation-form-section" class="hidden">
                    <div class="section-title">
                        <h2><i class="fas fa-calendar-plus"></i> Nouvelle réservation</h2>
                        <button class="btn btn-outline" id="backToAgenciesBtn">
                            <i class="fas fa-arrow-left"></i> Retour aux agences
                        </button>
                    </div>
                    
                    <!-- Message d'information sur la politique de réservation unique -->
                    <div class="reservation-info">
                        <i class="fas fa-info-circle"></i>
                        <span>Pour nos services de voyage, vous ne pouvez avoir qu'une seule réservation active à la fois. Une fois votre voyage terminé ou annulé, vous pourrez en réserver un nouveau.</span>
                    </div>
                    
                    <!-- Message d'avertissement pour réservation active (initialement caché) -->
                    <div id="activeReservationWarning" class="reservation-active-warning hidden">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Vous avez déjà une réservation active. Veuillez attendre que votre réservation actuelle soit complétée ou annulée avant d'en faire une nouvelle.</span>
                    </div>
                    
                    <div id="reservationAlert" class="alert hidden"></div>
                    
                    <div class="reservation-form">
                        <div class="reservation-agency">
                            <div class="agency-logo">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="agency-info">
                                <h3 id="selectedAgencyName">Nom de l'agence</h3>
                                <p id="selectedAgencyAddress">Adresse de l'agence</p>
                            </div>
                        </div>
                        
                        <form id="newReservationForm">
                            <input type="hidden" id="agencyId" name="agencyId">
                            
                            <div class="form-group">
                                <label for="service" class="form-label">Service requis</label>
                                <select id="service" name="service" class="form-control" required>
                                    <option value="">Sélectionnez un service</option>
                                    <!-- Les services seront ajoutés ici dynamiquement -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="description" class="form-label">Description</label>
                                <textarea id="description" name="description" class="form-control" placeholder="Décrivez vos besoins en détail..." required></textarea>
                            </div>
                            
                            <!-- Section de disponibilité en temps réel -->
                            <div class="form-group" id="availabilitySection">
                                <label class="form-label">Sélectionnez une date et un créneau horaire</label>
                                
                                <!-- Navigation de date -->
                                <div class="date-navigation">
                                    <button type="button" class="btn btn-outline btn-sm" id="prevWeekBtn">
                                        <i class="fas fa-chevron-left"></i> Semaine précédente
                                    </button>
                                    <span id="currentWeekLabel" class="current-week-label">Semaine du 01/01/2025</span>
                                    <button type="button" class="btn btn-outline btn-sm" id="nextWeekBtn">
                                        Semaine suivante <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                                
                                <!-- Calendrier de disponibilité -->
                                <div class="availability-calendar">
                                    <div class="calendar-days">
                                        <!-- Jours de la semaine générés par JS -->
                                    </div>
                                    <div class="calendar-slots">
                                        <!-- Créneaux horaires générés par JS -->
                                    </div>
                                </div>
                                
                                <!-- Créneau sélectionné -->
                                <input type="hidden" id="selectedDateTimeInput" name="selectedDateTime">
                                <div class="selected-time-display">
                                    <i class="fas fa-calendar-day"></i>
                                    <span id="selectedDateTimeDisplay">Aucun créneau sélectionné</span>
                                </div>
                            </div>
                            
                            <input type="hidden" id="preferredDate" name="preferredDate">
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" id="cancelReservationBtn">
                                    <i class="fas fa-times"></i> Annuler
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i> Soumettre la demande
                                </button>
                            </div>
                        </form>
                    </div>
                </section>
                
                <!-- Section Historique des Réservations -->
                <section id="reservation-history-section" class="hidden">
                    <div class="section-title">
                        <h2><i class="fas fa-history"></i> Mes réservations</h2>
                    </div>
                    
                    <div id="historyLoader" class="loader">
                        <div class="spinner"></div>
                        <p>Chargement des réservations...</p>
                    </div>
                    
                    <div id="historyAlert" class="alert hidden"></div>
                    
                    <div id="noReservations" class="no-results hidden">
                        <i class="fas fa-calendar-times"></i>
                        <p>Vous n'avez pas encore de réservations.</p>
                    </div>
                    
                    <div id="reservationList" class="reservation-list"></div>
                </section>
                
                <!-- Section Profil -->
                <section id="profile-section" class="hidden">
                    <div class="section-title">
                        <h2><i class="fas fa-user"></i> Mon profil</h2>
                    </div>
                    
                    <div id="profileAlert" class="alert hidden"></div>
                    
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="profile-info">
                                <h3 id="profileUsername">Nom d'utilisateur</h3>
                                <p id="profileEmail">Email</p>
                                
                                <!-- Statistiques utilisateur -->
                                <div class="profile-stats">
                                    <div class="stat-item">
                                        <div class="stat-value" id="statTotalReservations">0</div>
                                        <div class="stat-label">Réservations</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="statCompletedReservations">0</div>
                                        <div class="stat-label">Complétées</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="statAgenciesVisited">0</div>
                                        <div class="stat-label">Agences</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-tabs">
                            <div class="profile-tab active" data-tab="personal-info">Informations personnelles</div>
                            <div class="profile-tab" data-tab="change-password">Modifier mot de passe</div>
                            <div class="profile-tab" data-tab="delete-account">Supprimer compte</div>
                        </div>
                        
                        <div class="profile-content">
                            <!-- Section Informations personnelles -->
                            <div class="profile-section active" id="personal-info-section">
                                <div class="profile-data">
                                    <div class="profile-data-item">
                                        <i class="fas fa-user"></i>
                                        <span class="profile-label">Nom d'utilisateur</span>
                                        <div class="profile-value" id="personalInfoUsername"></div>
                                        <button class="btn btn-sm btn-outline" id="editUsernameBtn">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="profile-data-item">
                                        <i class="fas fa-envelope"></i>
                                        <span class="profile-label">Email</span>
                                        <div class="profile-value" id="personalInfoEmail"></div>
                                    </div>
                                    
                                    <div class="profile-data-item">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <span class="profile-label">Agences visitées</span>
                                        <div class="profile-value" id="agenciesVisitedList">Aucune pour le moment</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Section Modifier mot de passe -->
                            <div class="profile-section" id="change-password-section">
                                <form id="changePasswordForm">
                                    <div class="form-group">
                                        <label for="currentPassword" class="form-label">Mot de passe actuel</label>
                                        <input type="password" id="currentPassword" class="form-control" required>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-col">
                                            <div class="form-group">
                                                <label for="newPassword" class="form-label">Nouveau mot de passe</label>
                                                <input type="password" id="newPassword" class="form-control" required minlength="8">
                                            </div>
                                        </div>
                                        <div class="form-col">
                                            <div class="form-group">
                                                <label for="confirmPassword" class="form-label">Confirmer le mot de passe</label>
                                                <input type="password" id="confirmPassword" class="form-control" required minlength="8">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="text-right">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save"></i> Enregistrer
                                        </button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Section Supprimer compte -->
                            <div class="profile-section" id="delete-account-section">
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <div>
                                        <strong>Attention !</strong> La suppression de votre compte est irréversible. 
                                        Toutes vos données personnelles et historique de réservations seront définitivement supprimés.
                                    </div>
                                </div>
                                
                                <form id="deleteAccountForm">
                                    <div class="form-group">
                                        <label for="deleteConfirmPassword" class="form-label">Confirmez votre mot de passe</label>
                                        <input type="password" id="deleteConfirmPassword" class="form-control" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Confirmation</label>
                                        <div class="form-check">
                                            <input type="checkbox" id="deleteConfirmCheck" required>
                                            <label for="deleteConfirmCheck">
                                                Je confirme vouloir supprimer définitivement mon compte
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="text-right">
                                        <button type="submit" class="btn btn-danger">
                                            <i class="fas fa-trash"></i> Supprimer mon compte
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Section Aide & Support -->
                <section id="help-section" class="hidden">
                    <div class="section-title">
                        <h2><i class="fas fa-question-circle"></i> Aide & support</h2>
                    </div>
                    
                    <div id="helpAlert" class="alert hidden"></div>
                    
                    <div class="help-card">
                        <h3>Foire aux questions</h3>
                        
                        <div class="faq-item">
                            <div class="faq-question">
                                <i class="fas fa-question-circle"></i>
                                Comment puis-je prendre rendez-vous ?
                            </div>
                            <div class="faq-answer">
                                Pour prendre rendez-vous, accédez à la section "Nos agences", choisissez une agence, puis cliquez sur le bouton "Réserver". Sélectionnez ensuite le service souhaité, indiquez une description de votre besoin, choisissez une date et un créneau horaire, puis soumettez votre demande.
                            </div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question">
                                <i class="fas fa-question-circle"></i>
                                Comment puis-je annuler ou modifier ma réservation ?
                            </div>
                            <div class="faq-answer">
                                Vous pouvez consulter vos réservations dans la section "Mes réservations". Si votre réservation est encore en attente, vous pouvez la modifier ou l'annuler. Si elle est déjà confirmée, veuillez contacter l'agence concernée pour toute modification.
                            </div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question">
                                <i class="fas fa-question-circle"></i>
                                Comment savoir si ma réservation est confirmée ?
                            </div>
                            <div class="faq-answer">
                                Après soumission de votre demande, un agent examinera votre réservation. Vous recevrez une notification par email une fois votre réservation confirmée. Vous pouvez également vérifier le statut de votre réservation dans la section "Mes réservations".
                            </div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question">
                                <i class="fas fa-question-circle"></i>
                                Comment modifier mes informations personnelles ?
                            </div>
                            <div class="faq-answer">
                                Vous pouvez modifier vos informations personnelles dans la section "Mon profil". Vous pourrez y changer votre nom d'utilisateur et votre mot de passe. Notez que l'adresse email ne peut pas être modifiée pour des raisons de sécurité.
                            </div>
                        </div>
                    </div>
                    
                    <div class="help-contact mt-2">
                        <h3><i class="fas fa-envelope"></i> Contactez-nous</h3>
                        
                        <form id="contactForm">
                            <div class="form-group">
                                <label for="contactSubject" class="form-label">Sujet</label>
                                <select id="contactSubject" class="form-control" required>
                                    <option value="">Sélectionnez un sujet</option>
                                    <option value="Problème technique">Problème technique</option>
                                    <option value="Question sur ma réservation">Question sur ma réservation</option>
                                    <option value="Suggestion">Suggestion</option>
                                    <option value="Autre">Autre</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="contactMessage" class="form-label">Message</label>
                                <textarea id="contactMessage" class="form-control" rows="5" placeholder="Décrivez votre problème ou question..." required></textarea>
                            </div>
                            
                            <div class="text-right">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i> Envoyer
                                </button>
                            </div>
                        </form>
                    </div>
                </section>
            </main>
        </div>
    </div>
    
    <!-- Modal pour modifier le nom d'utilisateur -->
    <div id="editUsernameModal" class="modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-user-edit"></i> Modifier le nom d'utilisateur</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="editUsernameAlert" class="alert hidden"></div>
                <form id="editUsernameForm">
                    <div class="form-group">
                        <label for="newUsername" class="form-label">Nouveau nom d'utilisateur</label>
                        <input type="text" id="newUsername" class="form-control" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline cancel-modal">Annuler</button>
                <button type="button" class="btn btn-primary" id="saveUsernameBtn">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Modal de chargement -->
    <div id="loadingModal" class="modal">
        <div class="modal-dialog" style="max-width: 300px; text-align: center;">
            <div style="padding: 30px;">
                <div style="margin-bottom: 20px;">
                    <div class="spinner" style="margin: 0 auto;"></div>
                </div>
                <h3 style="margin-bottom: 10px; color: #4361ee;">Action en attente</h3>
                <p>Veuillez patienter...</p>
            </div>
        </div>
    </div>
    
    <!-- Modal de confirmation -->
    <div id="confirmModal" class="modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title" id="confirmModalTitle">Confirmation</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmModalMessage">Êtes-vous sûr de vouloir effectuer cette action ?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline cancel-modal">Annuler</button>
                <button type="button" class="btn btn-danger" id="confirmModalBtn">Confirmer</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de succès -->
    <div id="successModal" class="modal success-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-check-circle"></i> Confirmation</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="success-checkmark">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="success-message" id="successMessage">
                    Votre demande a été traitée avec succès !
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" id="successModalBtn">OK</button>
            </div>
        </div>
    </div>
    
    <!-- Modal pour laisser un avis -->
    <div id="feedbackModal" class="modal feedback-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-star"></i> Donnez votre avis</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="feedbackAlert" class="alert hidden"></div>
                <form id="feedbackForm">
                    <input type="hidden" id="feedbackReservationId">
                    
                    <div class="form-group">
                        <label class="form-label">Comment noteriez-vous votre expérience ?</label>
                        <div class="star-rating">
                            <button type="button" class="star-btn" data-rating="1"><i class="fas fa-star"></i></button>
                            <button type="button" class="star-btn" data-rating="2"><i class="fas fa-star"></i></button>
                            <button type="button" class="star-btn" data-rating="3"><i class="fas fa-star"></i></button>
                            <button type="button" class="star-btn" data-rating="4"><i class="fas fa-star"></i></button>
                            <button type="button" class="star-btn" data-rating="5"><i class="fas fa-star"></i></button>
                        </div>
                        <input type="hidden" id="ratingInput" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="feedbackComment" class="form-label">Commentaire (optionnel)</label>
                        <textarea id="feedbackComment" class="form-control" rows="4" placeholder="Partagez votre expérience..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline cancel-modal">Annuler</button>
                <button type="button" class="btn btn-primary" id="submitFeedbackBtn">Envoyer</button>
            </div>
        </div>
    </div>
    <script src="config.js"></script>
    <script>
// Fonction pour créer les particules
function createParticles() {
    const particles = document.getElementById('particles');
    const particleCount = 20;
    
    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        // Position aléatoire
        const x = Math.random() * 100;
        const y = Math.random() * 100;
        particle.style.left = `${x}%`;
        particle.style.top = `${y}%`;
        
        // Taille aléatoire
        const size = Math.random() * 5 + 3;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        
        // Couleur aléatoire
        const colors = ['rgba(67, 97, 238, 0.1)', 'rgba(16, 185, 129, 0.1)', 'rgba(59, 130, 246, 0.1)', 'rgba(245, 158, 11, 0.1)'];
        const color = colors[Math.floor(Math.random() * colors.length)];
        particle.style.backgroundColor = color;
        
        // Mouvement aléatoire
        const xMove = (Math.random() - 0.5) * 200;
        const yMove = (Math.random() - 0.5) * 200;
        particle.style.setProperty('--x', `${xMove}px`);
        particle.style.setProperty('--y', `${yMove}px`);
        
        // Durée d'animation aléatoire
        const duration = Math.random() * 10 + 10;
        particle.style.animationDuration = `${duration}s`;
        
        // Délai d'animation aléatoire
        const delay = Math.random() * 5;
        particle.style.animationDelay = `${delay}s`;
        
        particles.appendChild(particle);
    }
}

// Appeler la fonction au chargement de la page
document.addEventListener('DOMContentLoaded', createParticles);

// Base URL pour l'API
//const API_BASE_URL = 'http://localhost:8082';

// Variables globales
let allAgencies = [];
let allServices = [];
let currentAgencyId = null;
let currentAgencyServices = [];
let userData = null;
let selectedTimeSlot = null;
let currentConfirmCallback = null;
let userStats = null;
let currentFeedbackReservationId = null;

// Éléments du DOM
const usernameElement = document.getElementById('username');
const logoutBtn = document.getElementById('logoutBtn');
const menuItems = document.querySelectorAll('.sidebar-menu a');
const sections = document.querySelectorAll('main section');

// Éléments de la section Agences
const searchInput = document.getElementById('searchInput');
const cityFilter = document.getElementById('cityFilter');
const serviceFilter = document.getElementById('serviceFilter');
const agenciesLoader = document.getElementById('agenciesLoader');
const noAgencies = document.getElementById('noAgencies');
const agenciesGrid = document.getElementById('agenciesGrid');
const alertContainer = document.getElementById('alertContainer');

// Éléments de la section Formulaire de Réservation
const backToAgenciesBtn = document.getElementById('backToAgenciesBtn');
const newReservationForm = document.getElementById('newReservationForm');
const selectedAgencyName = document.getElementById('selectedAgencyName');
const selectedAgencyAddress = document.getElementById('selectedAgencyAddress');
const agencyIdInput = document.getElementById('agencyId');
const reservationAlert = document.getElementById('reservationAlert');
const cancelReservationBtn = document.getElementById('cancelReservationBtn');
const serviceSelect = document.getElementById('service');
const preferredDate = document.getElementById('preferredDate');
const selectedDateTimeInput = document.getElementById('selectedDateTimeInput');
const selectedDateTimeDisplay = document.getElementById('selectedDateTimeDisplay');
const prevWeekBtn = document.getElementById('prevWeekBtn');
const nextWeekBtn = document.getElementById('nextWeekBtn');
const currentWeekLabel = document.getElementById('currentWeekLabel');
const activeReservationWarning = document.getElementById('activeReservationWarning');

// Éléments de la section Historique
const historyLoader = document.getElementById('historyLoader');
const historyAlert = document.getElementById('historyAlert');
const noReservations = document.getElementById('noReservations');
const reservationList = document.getElementById('reservationList');

// Éléments de la section Profil
const profileAlert = document.getElementById('profileAlert');
const profileUsername = document.getElementById('profileUsername');
const profileEmail = document.getElementById('profileEmail');
const personalInfoUsername = document.getElementById('personalInfoUsername');
const personalInfoEmail = document.getElementById('personalInfoEmail');
const profileTabs = document.querySelectorAll('.profile-tab');
const profileSections = document.querySelectorAll('.profile-section');
const editUsernameBtn = document.getElementById('editUsernameBtn');
const changePasswordForm = document.getElementById('changePasswordForm');
const deleteAccountForm = document.getElementById('deleteAccountForm');

// Éléments des statistiques utilisateur
const statTotalReservations = document.getElementById('statTotalReservations');
const statCompletedReservations = document.getElementById('statCompletedReservations');
const statAgenciesVisited = document.getElementById('statAgenciesVisited');
const agenciesVisitedList = document.getElementById('agenciesVisitedList');

// Éléments du modal de modification du nom d'utilisateur
const editUsernameModal = document.getElementById('editUsernameModal');
const editUsernameForm = document.getElementById('editUsernameForm');
const newUsername = document.getElementById('newUsername');
const saveUsernameBtn = document.getElementById('saveUsernameBtn');
const editUsernameAlert = document.getElementById('editUsernameAlert');

// Éléments du modal de succès
const successModal = document.getElementById('successModal');
const successMessage = document.getElementById('successMessage');
const successModalBtn = document.getElementById('successModalBtn');

// Éléments du modal de feedback
const feedbackModal = document.getElementById('feedbackModal');
const feedbackForm = document.getElementById('feedbackForm');
const feedbackReservationId = document.getElementById('feedbackReservationId');
const ratingInput = document.getElementById('ratingInput');
const feedbackComment = document.getElementById('feedbackComment');
const starButtons = document.querySelectorAll('.star-btn');
const submitFeedbackBtn = document.getElementById('submitFeedbackBtn');
const feedbackAlert = document.getElementById('feedbackAlert');

// Éléments de la section Aide
const helpAlert = document.getElementById('helpAlert');
const contactForm = document.getElementById('contactForm');

// Éléments du modal de confirmation
const confirmModal = document.getElementById('confirmModal');
const confirmModalTitle = document.getElementById('confirmModalTitle');
const confirmModalMessage = document.getElementById('confirmModalMessage');
const confirmModalBtn = document.getElementById('confirmModalBtn');

// Initialisation au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    // Définir la date minimale pour le sélecteur de date à aujourd'hui
    const today = new Date().toISOString().split('T')[0];
    preferredDate.min = today;
    
    // Vérifier la session
    checkSession();
    
    // Initialiser les écouteurs d'événements
    initializeEventListeners();
});

// Initialiser les écouteurs d'événements
function initializeEventListeners() {
    // Navigation dans le menu latéral
    menuItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Supprimer la classe active de tous les liens
            menuItems.forEach(menuItem => menuItem.classList.remove('active'));
            
            // Ajouter la classe active au lien cliqué
            this.classList.add('active');
            
            // Afficher la section correspondante
            const sectionId = this.getAttribute('data-section');
            sections.forEach(section => section.classList.add('hidden'));
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Charger les données si nécessaire
            if (sectionId === 'agencies-section') {
                loadAgencies();
            } else if (sectionId === 'reservation-history-section') {
                loadReservations();
            } else if (sectionId === 'profile-section') {
                loadUserProfile();
            }
        });
    });
    
    // Recherche et filtres
    searchInput.addEventListener('input', filterAgencies);
    cityFilter.addEventListener('change', filterAgencies);
    serviceFilter.addEventListener('change', filterAgencies);
    
    // Navigation dans le calendrier de disponibilité
    prevWeekBtn.addEventListener('click', function() {
        availabilityCalendar.navigateWeek(-7);
    });
    
    nextWeekBtn.addEventListener('click', function() {
        availabilityCalendar.navigateWeek(7);
    });
    
    // Retour à la liste des agences
    backToAgenciesBtn.addEventListener('click', function(e) {
        e.preventDefault();
        cancelReservationForm();
    });
    
    // Annulation de la réservation
    cancelReservationBtn.addEventListener('click', function(e) {
        e.preventDefault();
        cancelReservationForm();
    });
    
    // Soumission du formulaire de réservation
    newReservationForm.addEventListener('submit', function(e) {
        e.preventDefault();
        createReservation();
    });
    
    // Navigation dans les onglets du profil
    profileTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const tabName = this.getAttribute('data-tab');
            
            // Activer l'onglet
            profileTabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Afficher la section correspondante
            profileSections.forEach(section => section.classList.remove('active'));
            document.getElementById(`${tabName}-section`).classList.add('active');
        });
    });
    
    // Modifier le nom d'utilisateur
    editUsernameBtn.addEventListener('click', function() {
        openEditUsernameModal();
    });
    
    // Enregistrer le nouveau nom d'utilisateur
    saveUsernameBtn.addEventListener('click', function() {
        updateUsername();
    });
    
    // Formulaire de changement de mot de passe
    changePasswordForm.addEventListener('submit', function(e) {
        e.preventDefault();
        changePassword();
    });
    
    // Formulaire de suppression de compte
    deleteAccountForm.addEventListener('submit', function(e) {
        e.preventDefault();
        showConfirmModal(
            'Supprimer mon compte',
            'Cette action est définitive. Êtes-vous vraiment sûr de vouloir supprimer votre compte?',
            deleteAccount
        );
    });
    
    // Évaluation par étoiles
    starButtons.forEach(button => {
        button.addEventListener('click', function() {
            const rating = parseInt(this.getAttribute('data-rating'));
            ratingInput.value = rating;
            
            // Mettre à jour l'affichage des étoiles
            starButtons.forEach((btn, index) => {
                if (index < rating) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        });
    });
    
    // Soumettre un feedback
    submitFeedbackBtn.addEventListener('click', function() {
        submitFeedback();
    });
    
    // Formulaire de contact
    contactForm.addEventListener('submit', function(e) {
        e.preventDefault();
        submitContactForm();
    });
    
    // Fermer le modal de succès
    successModalBtn.addEventListener('click', function() {
        closeAllModals();
    });
    
    // Déconnexion
    logoutBtn.addEventListener('click', logout);
    
    // Fermer les modals
    document.querySelectorAll('.close-modal, .cancel-modal').forEach(button => {
        button.addEventListener('click', function() {
            closeAllModals();
        });
    });
    
    // Fermer les modals quand on clique en dehors
    window.addEventListener('click', function(event) {
        if (event.target.classList.contains('modal')) {
            closeAllModals();
        }
    });
}

// Vérifier la session utilisateur
async function checkSession() {
    try {
        const response = await fetch(`${API_BASE_URL}/auth/check-session`, {
            method: 'GET',
            credentials: 'include'
        });
        
        const data = await response.json();
        
        if (response.ok && data.success) {
            // Extraire les informations de l'utilisateur
            const parts = data.message.split('|');
            const email = parts[0];
            const role = parts[1];
            const username = parts.length > 2 ? parts[2] : email.split('@')[0];
            
            // Vérifier si l'utilisateur a le rôle USER
            if (!role.includes('ROLE_USER')) {
                // Rediriger vers la page appropriée
                if (role.includes('ROLE_ADMIN')) {
                    window.location.href = 'admin-dashboard.html';
                } else if (role.includes('ROLE_AGENT')) {
                    window.location.href = 'agent-dashboard.html';
                } else {
                    // Utilisateur sans rôle valide, rediriger vers la page de connexion
                    window.location.href = 'auth.html';
                }
                return;
            }
            
            // Stocker les informations de l'utilisateur
            userData = {
                email: email,
                role: role,
                username: username
            };
            
            // Afficher le nom d'utilisateur
            usernameElement.textContent = username;
            
            // Charger les statistiques de l'utilisateur
            loadUserStats();
            
            // Charger les agences
            loadAgencies();
        } else {
            // Session non active, rediriger vers la page de connexion
            window.location.href = 'auth.html';
        }
    } catch (error) {
        console.error('Erreur lors de la vérification de la session:', error);
        // En cas d'erreur, rediriger vers la page de connexion
        window.location.href = 'auth.html';
    }
}

// Charger les statistiques de l'utilisateur
async function loadUserStats() {
    try {
        const response = await fetch(`${API_BASE_URL}/api/user/stats`, {
            method: 'GET',
            credentials: 'include'
        });
        
        if (response.ok) {
            userStats = await response.json();
            console.log('Statistiques utilisateur:', userStats);
            
            // Mettre à jour les statistiques dans l'interface
            if (userStats) {
                statTotalReservations.textContent = userStats.totalReservations || '0';
                statCompletedReservations.textContent = userStats.completedReservations || '0';
                statAgenciesVisited.textContent = userStats.agenciesVisited ? userStats.agenciesVisited.length : '0';
                
                // Mettre à jour la liste des agences visitées
                if (userStats.agenciesVisited && userStats.agenciesVisited.length > 0) {
                    agenciesVisitedList.textContent = userStats.agenciesVisited.join(', ');
                } else {
                    agenciesVisitedList.textContent = 'Aucune pour le moment';
                }
            }
        }
    } catch (error) {
        console.error('Erreur lors du chargement des statistiques utilisateur:', error);
    }
}

// Charger les agences
async function loadAgencies() {
    // Afficher le loader
    agenciesLoader.classList.remove('hidden');
    noAgencies.classList.add('hidden');
    agenciesGrid.innerHTML = '';
    
    try {
        // Charger les services pour les filtres
        const servicesResponse = await fetch(`${API_BASE_URL}/api/services`, {
            method: 'GET',
            credentials: 'include'
        });
        
        if (servicesResponse.ok) {
            allServices = await servicesResponse.json();
            
            // Remplir le filtre de services
            serviceFilter.innerHTML = '<option value="">Tous les services</option>';
            allServices.forEach(service => {
                const option = document.createElement('option');
                option.value = service.id;
                option.textContent = service.name;
                serviceFilter.appendChild(option);
            });
        }
        
        // Charger les agences
const agenciesResponse = await fetch(`${API_BASE_URL}/api/agencies/public`, {
    method: 'GET',
    credentials: 'include'
});

if (agenciesResponse.ok) {
    allAgencies = await agenciesResponse.json();
    
    if (allAgencies.length === 0) {
        // Aucune agence trouvée
        noAgencies.classList.remove('hidden');
    } else {
        // Remplir le filtre de villes
        const cities = [...new Set(allAgencies.map(agency => agency.city))];
        cityFilter.innerHTML = '<option value="">Toutes les villes</option>';
        cities.forEach(city => {
            const option = document.createElement('option');
            option.value = city;
            option.textContent = city;
            cityFilter.appendChild(option);
        });
        
        // Afficher les agences
        displayAgencies(allAgencies);
    }
} else {
    // Erreur lors du chargement des agences
    showAlert(alertContainer, 'Une erreur est survenue lors du chargement des agences.', 'danger');
}
} catch (error) {
    console.error('Erreur lors du chargement des agences:', error);
    showAlert(alertContainer, 'Erreur de connexion au serveur.', 'danger');
} finally {
    // Masquer le loader
    agenciesLoader.classList.add('hidden');
}
}

// Filtrer les agences
function filterAgencies() {
    const searchTerm = searchInput.value.toLowerCase().trim();
    const selectedCity = cityFilter.value;
    const selectedService = serviceFilter.value;
    
    let filteredAgencies = allAgencies;
    
    // Filtrer par terme de recherche
    if (searchTerm) {
        filteredAgencies = filteredAgencies.filter(agency => 
            agency.name.toLowerCase().includes(searchTerm) || 
            agency.city.toLowerCase().includes(searchTerm)
        );
    }
    
    // Filtrer par ville
    if (selectedCity) {
        filteredAgencies = filteredAgencies.filter(agency => agency.city === selectedCity);
    }
    
    // Filtrer par service
    if (selectedService) {
        filteredAgencies = filteredAgencies.filter(agency => {
            if (!agency.services || !Array.isArray(agency.services)) {
                return false;
            }
            
            return agency.services.some(service => {
                if (typeof service === 'object' && service !== null) {
                    return service.id == selectedService;
                } else if (typeof service === 'number') {
                    return service == selectedService;
                }
                return false;
            });
        });
    }
    
    // Afficher les résultats
    if (filteredAgencies.length === 0) {
        agenciesGrid.innerHTML = '';
        noAgencies.classList.remove('hidden');
    } else {
        displayAgencies(filteredAgencies);
        noAgencies.classList.add('hidden');
    }
}

// Afficher les agences dans la grille
function displayAgencies(agencies) {
    agenciesGrid.innerHTML = '';
    
    agencies.forEach(agency => {
        // Formater les services
        let servicesHtml = '<p>Aucun service disponible</p>';
        if (agency.services && Array.isArray(agency.services) && agency.services.length > 0) {
            servicesHtml = '<div class="services-list">';
            agency.services.forEach(service => {
                let serviceName = "Service inconnu";
                
                if (typeof service === 'object' && service !== null) {
                    serviceName = service.name || "Sans nom";
                } else if (typeof service === 'number') {
                    const foundService = allServices.find(s => s.id === service);
                    serviceName = foundService ? foundService.name : `Service #${service}`;
                }
                
                servicesHtml += `<span class="service-item">${serviceName}</span>`;
            });
            servicesHtml += '</div>';
        }
        
        // Déterminer les heures d'ouverture aujourd'hui
        const businessHoursText = getBusinessHoursText(agency.businessHours);
        
        // Créer la carte
        const card = document.createElement('div');
        card.className = 'agency-card';
        
        card.innerHTML = `
            <div class="card-header">
                <div class="card-avatar">
                    <i class="fas fa-building"></i>
                </div>
                <div class="card-title-container">
                    <h3 class="card-title">${agency.name}</h3>
                    <div class="card-subtitle"><i class="fas fa-map-marker-alt"></i> ${agency.city}</div>
                </div>
            </div>
            <div class="card-body">
                <div class="card-details">
                    <div class="card-detail">
                        <i class="fas fa-map-pin"></i>
                        <div class="detail-value">${agency.address}</div>
                    </div>
                    <div class="card-detail">
                        <i class="fas fa-phone"></i>
                        <div class="detail-value">${agency.phoneNumber}</div>
                    </div>
                    <div class="card-detail">
                        <i class="fas fa-envelope"></i>
                        <div class="detail-value">${agency.email || 'Non disponible'}</div>
                    </div>
                    ${agency.description ? `
                    <div class="card-detail">
                        <i class="fas fa-info-circle"></i>
                        <div class="detail-value">${agency.description}</div>
                    </div>
                    ` : ''}
                </div>
                <div class="card-services">
                    <div class="services-title">
                        <i class="fas fa-concierge-bell"></i> Services proposés
                    </div>
                    ${servicesHtml}
                </div>
            </div>
            <div class="card-footer">
                <div class="hours-open">
                    <i class="fas fa-clock"></i>
                    <span>${businessHoursText}</span>
                </div>
                <button class="btn btn-primary book-agency-btn" data-id="${agency.id}">
                    <i class="fas fa-calendar-plus"></i> Réserver
                </button>
            </div>
        `;
        
        agenciesGrid.appendChild(card);
        
        // Ajouter l'écouteur d'événement pour le bouton de réservation
        card.querySelector('.book-agency-btn').addEventListener('click', function() {
            const agencyId = this.getAttribute('data-id');
            openReservationForm(agencyId);
        });
    });
}

// Obtenir le texte des heures d'ouverture
function getBusinessHoursText(businessHours) {
    if (!businessHours || businessHours.length === 0) {
        return 'Horaires non disponibles';
    }
    
    // Obtenir le jour actuel (0 = Dimanche, 1 = Lundi, etc.)
    const today = new Date().getDay();
    const daysOfWeek = ['SUNDAY', 'MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY', 'SATURDAY'];
    const todayName = daysOfWeek[today];
    
    // Trouver les heures d'ouverture pour aujourd'hui
    const todayHours = businessHours.find(hour => hour.day === todayName);
    
    if (!todayHours) {
        return 'Horaires non disponibles';
    }
    
    if (todayHours.closed) {
        return 'Fermé aujourd\'hui';
    }
    
    return `Ouvert aujourd'hui: ${todayHours.openingTime} - ${todayHours.closingTime}`;
}

// Fonction pour ouvrir le formulaire de réservation
function openReservationForm(agencyId) {
    // Vérifier si l'utilisateur a une réservation active
    fetch(`${API_BASE_URL}/api/user/has-active-reservation`, {
        method: 'GET',
        credentials: 'include'
    })
    .then(response => response.json())
    .then(data => {
        if (data.hasActiveReservation) {
            // Masquer d'abord tous les autres avertissements ou alertes
            reservationAlert.classList.add('hidden');
            
            // Afficher un avertissement et ne pas ouvrir le formulaire
            activeReservationWarning.classList.remove('hidden');
            
            // Faire défiler vers le haut pour que l'avertissement soit visible
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Afficher un modal de notification
            showConfirmModal(
                'Réservation active',
                'Vous avez déjà une réservation active. Vous ne pouvez pas créer de nouvelle réservation tant que celle-ci n\'est pas complétée ou annulée.',
                () => {
                    // Rediriger vers l'historique des réservations
                    showSection('reservation-history-section');
                    menuItems.forEach(item => {
                        if (item.getAttribute('data-section') === 'reservation-history-section') {
                            item.classList.add('active');
                        } else {
                            item.classList.remove('active');
                        }
                    });
                    loadReservations();
                    
                    // Masquer l'avertissement après la redirection
                    activeReservationWarning.classList.add('hidden');
                }
            );
            
            return;
        }
        
        // Le reste du code existant pour ouvrir le formulaire
        const agency = allAgencies.find(a => a.id == agencyId);
        
        if (!agency) {
            showAlert(alertContainer, 'Agence non trouvée.', 'danger');
            return;
        }
        
        // Mettre à jour les informations de l'agence sélectionnée
        selectedAgencyName.textContent = agency.name;
        selectedAgencyAddress.textContent = agency.address;
        agencyIdInput.value = agency.id;
        currentAgencyId = agency.id;
        
        // Réinitialiser le formulaire
        newReservationForm.reset();
        reservationAlert.classList.add('hidden');
        
        // Charger les services de l'agence dans le select
        serviceSelect.innerHTML = '<option value="">Sélectionnez un service</option>';
        currentAgencyServices = [];
        
        if (agency.services && Array.isArray(agency.services)) {
            agency.services.forEach(service => {
                let serviceId, serviceName;
                
                if (typeof service === 'object' && service !== null) {
                    serviceId = service.id;
                    serviceName = service.name;
                } else if (typeof service === 'number') {
                    serviceId = service;
                    const foundService = allServices.find(s => s.id === service);
                    serviceName = foundService ? foundService.name : `Service #${service}`;
                }
                
                if (serviceId && serviceName) {
                    const option = document.createElement('option');
                    option.value = serviceName;
                    option.textContent = serviceName;
                    serviceSelect.appendChild(option);
                    
                    currentAgencyServices.push({
                        id: serviceId,
                        name: serviceName
                    });
                }
            });
        }
        
        // Initialiser le calendrier de disponibilité
        availabilityCalendar.initialize(agency.id);
        
        // Afficher la section du formulaire de réservation
        showSection('reservation-form-section');
    })
    .catch(error => {
        console.error('Erreur lors de la vérification des réservations actives:', error);
        showAlert(alertContainer, 'Une erreur est survenue. Veuillez réessayer.', 'danger');
    });
}
// Availability Calendar Management
const availabilityCalendar = {
    currentStartDate: null,
    selectedAgencyId: null,
    selectedDateTime: null,
    stompClient: null,
    passedSlotsTimer: null,
    
    // Initialize the calendar
    initialize: function(agencyId) {
        this.selectedAgencyId = agencyId;
        this.currentStartDate = this.getStartOfWeek(new Date());
        this.selectedDateTime = null;
        
        // Connect to WebSocket for real-time updates
        this.connectWebSocket();
        
        // Load initial data
        this.loadWeekAvailability();
        
        // Start checking for passed slots
        this.startPassedSlotsTimer();
    },
    
    // Get the start date of the week (Monday) for a given date
    getStartOfWeek: function(date) {
        const day = date.getDay();
        const diff = date.getDate() - day + (day === 0 ? -6 : 1); // Adjust for Sunday
        return new Date(date.setDate(diff));
    },
    
    // Navigate weeks
    navigateWeek: function(daysToAdd) {
        const newDate = new Date(this.currentStartDate);
        newDate.setDate(newDate.getDate() + daysToAdd);
        this.currentStartDate = newDate;
        this.loadWeekAvailability();
    },
    
    // Format date to YYYY-MM-DD
    formatDate: function(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    },
    
    // Format date to display
    formatDateDisplay: function(date) {
        return date.toLocaleDateString('fr-FR', { 
            weekday: 'short', 
            day: 'numeric', 
            month: 'short' 
        });
    },
    
    // Check if date is today
    isToday: function(date) {
        const today = new Date();
        return date.getDate() === today.getDate() && 
               date.getMonth() === today.getMonth() && 
               date.getFullYear() === today.getFullYear();
    },
    
    // Check if date is in the past
    isPastDate: function(date) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        return date < today;
    },
    
    // Check if time slot is in the past (for today)
    isPastTimeSlot: function(timeStr) {
        const [hours, minutes] = timeStr.split(':');
        const slotHour = parseInt(hours);
        const slotMinutes = parseInt(minutes);
        
        const now = new Date();
        const currentHour = now.getHours();
        const currentMinutes = now.getMinutes();
        
        if (slotHour < currentHour) {
            return true;
        }
        
        if (slotHour === currentHour && slotMinutes <= currentMinutes) {
            return true;
        }
        
        return false;
    },
    
    // Démarrer un timer pour vérifier les créneaux passés régulièrement
    startPassedSlotsTimer: function() {
        // Arrêter le timer précédent s'il existe
        this.stopPassedSlotsTimer();
        
        // Créer un nouveau timer
        this.passedSlotsTimer = setInterval(() => {
            this.checkForPassedSlots();
        }, 30000); // Vérifier toutes les 30 secondes
    },

    // Arrêter le timer
    stopPassedSlotsTimer: function() {
        if (this.passedSlotsTimer) {
            clearInterval(this.passedSlotsTimer);
            this.passedSlotsTimer = null;
        }
    },

    // Vérifier si des créneaux sont devenus passés
    checkForPassedSlots: function() {
        const now = new Date();
        const today = this.formatDate(now);
        
        // Pour chaque créneau du jour actuel
        document.querySelectorAll('.time-slot.available').forEach(slot => {
            if (slot.dataset.date === today) {
                const timeStr = slot.dataset.time;
                if (timeStr && this.isPastTimeSlot(timeStr)) {
                    console.log(`Créneau ${timeStr} est maintenant passé, mise à jour de l'interface`);
                    
                    // Marquer comme passé
                    slot.classList.remove('available');
                    slot.classList.add('past-slot');
                    
                    // Supprimer les écouteurs d'événements
                    const newSlot = slot.cloneNode(true);
                    const [hours, minutes] = timeStr.split(':');
                    const formattedTime = `${parseInt(hours)}h${minutes}`;
                    newSlot.textContent = `${formattedTime} (passé)`;
                    slot.parentNode.replaceChild(newSlot, slot);
                }
            }
        });
    },
    
    // Load availability data for the week
    loadWeekAvailability: function() {
        const startDateStr = this.formatDate(this.currentStartDate);
        
        // Update week label
        currentWeekLabel.textContent = `Semaine du ${this.currentStartDate.toLocaleDateString('fr-FR')}`;
        
        // Clear any existing selection
        this.clearSelection();
        
        // Show loading state
        this.showLoadingState();
        
        // Fetch availability data
        fetch(`${API_BASE_URL}/api/availability/${this.selectedAgencyId}/week?startDate=${startDateStr}`, {
            method: 'GET',
            credentials: 'include'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Erreur lors du chargement des disponibilités');
            }
            return response.json();
        })
        .then(data => {
            console.log("Données de disponibilité reçues:", data);
            this.renderCalendar(data);
            
            // Vérifier immédiatement s'il y a des créneaux passés
            this.checkForPassedSlots();
        })
        .catch(error => {
            console.error('Erreur:', error);
            // Show error message
            this.renderCalendarError();
        });
    },
    
    // Show loading state
    showLoadingState: function() {
        const calendarDays = document.querySelector('.calendar-days');
        const calendarSlots = document.querySelector('.calendar-slots');
        
        calendarDays.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><span>Chargement...</span></div>';
        calendarSlots.innerHTML = '';
    },
    
    // Render calendar error
    renderCalendarError: function() {
        const calendarDays = document.querySelector('.calendar-days');
        calendarDays.innerHTML = '<div class="error"><i class="fas fa-exclamation-triangle"></i><span>Impossible de charger les disponibilités</span></div>';
    },
    
    // Render the calendar with availability data
    renderCalendar: function(availabilityData) {
        const calendarDays = document.querySelector('.calendar-days');
        const calendarSlots = document.querySelector('.calendar-slots');
        
        // Clear previous content
        calendarDays.innerHTML = '';
        calendarSlots.innerHTML = '';
        
        // Generate 7 days from the current start date
        for (let i = 0; i < 7; i++) {
            const currentDate = new Date(this.currentStartDate);
            currentDate.setDate(currentDate.getDate() + i);
            
            // Find availability data for this date
            const dateStr = this.formatDate(currentDate);
            const dayAvailability = availabilityData.find(day => day.date === dateStr) || {
                date: dateStr,
                availableTimeSlots: [],
                bookedTimeSlots: []
            };
            
            // Check if this date is in the past
            const isPastDate = this.isPastDate(currentDate);
            
            // Create day header
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            if (this.isToday(currentDate)) {
                dayElement.classList.add('today');
            }
            if (isPastDate) {
                dayElement.classList.add('past-date');
            }
            
            dayElement.innerHTML = `
                <span class="day-name">${currentDate.toLocaleDateString('fr-FR', { weekday: 'short' })}</span>
                <span class="day-date">${currentDate.getDate()}</span>
            `;
            calendarDays.appendChild(dayElement);
            
            // Create slots container for this day
            const daySlotsElement = document.createElement('div');
            daySlotsElement.className = 'day-slots';
            calendarSlots.appendChild(daySlotsElement);
            
            // For past dates, show message
            if (isPastDate) {
                const pastDateElement = document.createElement('div');
                pastDateElement.className = 'time-slot past-date-message';
                pastDateElement.textContent = 'Date passée';
                daySlotsElement.appendChild(pastDateElement);
                continue; // Skip to next day
            }
            
            // Add time slots
            if (dayAvailability.availableTimeSlots.length === 0 && dayAvailability.bookedTimeSlots.length === 0) {
                // No slots available
                const noSlotsElement = document.createElement('div');
                noSlotsElement.className = 'time-slot no-slots';
                noSlotsElement.textContent = 'Pas de créneaux';
                daySlotsElement.appendChild(noSlotsElement);
            } else {
                // Combine and sort all time slots
                const allSlots = [...new Set([
                    ...dayAvailability.availableTimeSlots,
                    ...dayAvailability.bookedTimeSlots
                ])].sort();
                
                allSlots.forEach(timeStr => {
                    const isAvailable = dayAvailability.availableTimeSlots.includes(timeStr);
                    const isBooked = dayAvailability.bookedTimeSlots.includes(timeStr);
                    
                    // Check if this slot is in the past (for today only)
                    const isPastSlot = this.isToday(currentDate) && this.isPastTimeSlot(timeStr);
                    
                    const timeSlotElement = document.createElement('div');
                    timeSlotElement.className = 'time-slot';
                    
                    // Format time for display (e.g., "09:00" to "9h00")
                    const [hours, minutes] = timeStr.split(':');
                    const formattedTime = `${parseInt(hours)}h${minutes}`;
                    
                    if (isPastSlot) {
                        // Past time slots
                        timeSlotElement.classList.add('past-slot');
                        timeSlotElement.textContent = `${formattedTime} (passé)`;
                    } else if (isAvailable) {
                        // Available time slots
                        timeSlotElement.classList.add('available');
                        timeSlotElement.textContent = formattedTime;
                        
                        // Set data attributes for selection
                        timeSlotElement.dataset.date = dateStr;
                        timeSlotElement.dataset.time = timeStr;
                        
                        // Add click event for selection
                        timeSlotElement.addEventListener('click', () => {
                            this.selectTimeSlot(timeSlotElement, dateStr, timeStr);
                        });
                    } else if (isBooked) {
                        // Booked time slots
                        timeSlotElement.classList.add('booked');
                        timeSlotElement.textContent = formattedTime;
                    }
                    
                    daySlotsElement.appendChild(timeSlotElement);
                });
            }
        }
    },
    
    // Select a time slot
    selectTimeSlot: function(element, dateStr, timeStr) {
        // Clear previous selection
        document.querySelectorAll('.time-slot.selected').forEach(slot => {
            slot.classList.remove('selected');
        });
        
        // Mark as selected
        element.classList.add('selected');
        
        // Save selected datetime
        this.selectedDateTime = `${dateStr}T${timeStr}`;
        
        // Update hidden input
        selectedDateTimeInput.value = this.selectedDateTime;
        
        // Update display
        const displayDate = new Date(dateStr + 'T' + timeStr);
        const formattedDisplay = `${displayDate.toLocaleDateString('fr-FR')} à ${timeStr.replace(':', 'h')}`;
        selectedDateTimeDisplay.textContent = formattedDisplay;
        
        // Update preferred date field
        preferredDate.value = this.selectedDateTime;
        
        console.log("Créneau sélectionné:", this.selectedDateTime);
    },
    
    // Clear selection
    clearSelection: function() {
        document.querySelectorAll('.time-slot.selected').forEach(slot => {
            slot.classList.remove('selected');
        });
        
        this.selectedDateTime = null;
        selectedDateTimeInput.value = '';
        selectedDateTimeDisplay.textContent = 'Aucun créneau sélectionné';
    },
    
    // Connect to WebSocket for real-time updates
    connectWebSocket: function() {
        // Charger les bibliothèques SockJS et STOMP si nécessaire
        if (typeof SockJS === 'undefined' || typeof Stomp === 'undefined') {
            console.log("Chargement des bibliothèques SockJS et STOMP...");
            const sockjs = document.createElement('script');
            sockjs.src = 'https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js';
            sockjs.async = true;
            
            const stomp = document.createElement('script');
            stomp.src = 'https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js';
            stomp.async = true;
            
            document.head.appendChild(sockjs);
            document.head.appendChild(stomp);
            
            // After scripts are loaded
            stomp.onload = () => {
                console.log("Bibliothèques chargées, initialisation de la connexion WebSocket");
                this.initializeWebSocketConnection();
            };
        } else {
            console.log("Bibliothèques déjà disponibles, initialisation de la connexion WebSocket");
            this.initializeWebSocketConnection();
        }
    },
    
    // Initialize WebSocket connection
    initializeWebSocketConnection: function() {
        const socket = new SockJS(`${API_BASE_URL}/reservation-websocket`);
        this.stompClient = Stomp.over(socket);
        
        // Disable debug logs
        this.stompClient.debug = null;
        
        this.stompClient.connect({}, frame => {
            console.log('Connected to WebSocket for Availability');
            
            // Subscribe to availability updates for the selected agency
            this.stompClient.subscribe(`/topic/availability/${this.selectedAgencyId}`, message => {
                try {
                    const updatedAvailability = JSON.parse(message.body);
                    console.log("Réception mise à jour disponibilité:", updatedAvailability);
                    this.handleAvailabilityUpdate(updatedAvailability);
                } catch (e) {
                    console.error('Error processing WebSocket message:', e);
                }
            });
            
            // Demander les disponibilités actuelles
            this.stompClient.send(`/app/fetch-availability/${this.selectedAgencyId}`, {}, this.formatDate(this.currentStartDate));
        }, error => {
            console.error('WebSocket connection error:', error);
            // Will fallback to regular AJAX updates
        });
    },
    
    // Handle availability update from WebSocket
    handleAvailabilityUpdate: function(updatedAvailability) {
        // Si nous sommes en train de visualiser la semaine qui contient cette date, recharger le calendrier
        const updateDate = new Date(updatedAvailability.date);
        const weekStart = new Date(this.currentStartDate);
        const weekEnd = new Date(this.currentStartDate);
        weekEnd.setDate(weekEnd.getDate() + 6);
        
        if (updateDate >= weekStart && updateDate <= weekEnd) {
            console.log("Mise à jour détectée dans la semaine actuelle, rechargement du calendrier");
            this.loadWeekAvailability();
        }
    },
    
    // Disconnect WebSocket
    disconnect: function() {
        // Arrêter le timer de vérification des créneaux passés
        this.stopPassedSlotsTimer();
        
        // Déconnecter le WebSocket
        if (this.stompClient && this.stompClient.connected) {
            console.log("Déconnexion du WebSocket");
            this.stompClient.disconnect();
        }
    }
};

// Annuler le formulaire de réservation et revenir à la liste des agences
function cancelReservationForm() {
    // Disconnect the WebSocket connection
    availabilityCalendar.disconnect();
    
    // Revenir à la liste des agences
    showSection('agencies-section');
    menuItems.forEach(item => {
        if (item.getAttribute('data-section') === 'agencies-section') {
            item.classList.add('active');
        } else {
            item.classList.remove('active');
        }
    });
}

// Créer une nouvelle réservation
async function createReservation() {
    const service = document.getElementById('service').value;
    const description = document.getElementById('description').value;
    const selectedDateTime = selectedDateTimeInput.value;
    const agencyId = agencyIdInput.value;
    
    // Vérification des champs
    if (!service) {
        showReservationAlert('Veuillez sélectionner un service.', 'warning');
        return;
    }
    
    if (!description) {
        showReservationAlert('Veuillez fournir une description de votre besoin.', 'warning');
        return;
    }
    
    if (!selectedDateTime) {
        showReservationAlert('Veuillez sélectionner un créneau horaire.', 'warning');
        return;
    }
    
    console.log("Création de réservation avec:", { service, description, preferredDate: selectedDateTime, agencyId });
    
    try {
        const response = await fetch(`${API_BASE_URL}/api/user/reservation`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                service,
                description,
                preferredDate: selectedDateTime,
                agencyId: parseInt(agencyId)
            }),
            credentials: 'include'
        });
        
        const data = await response.json();
        
        if (response.ok) {
            console.log("Réservation créée avec succès:", data);
            
            // Réinitialiser le formulaire
            newReservationForm.reset();
            
            // Afficher le modal de succès
            showSuccessModal(
                'Votre demande de réservation a été créée avec succès !',
                'Un agent va examiner votre demande et vous recevrez bientôt un email de confirmation.'
            );
            
            // Rediriger vers l'historique des réservations après fermeture du modal
            successModalBtn.onclick = function() {
                // Disconnect the WebSocket connection
                availabilityCalendar.disconnect();
                
                // Rediriger vers l'historique des réservations
                showSection('reservation-history-section');
                menuItems.forEach(item => {
                    if (item.getAttribute('data-section') === 'reservation-history-section') {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
                loadReservations();
                
                // Fermer le modal
                closeAllModals();
            };
        } else {
            console.error("Erreur lors de la création de la réservation:", data);
            showReservationAlert(data.message || 'Une erreur est survenue lors de la création de la réservation.', 'danger');
        }
    } catch (error) {
        console.error('Erreur lors de la création de la réservation:', error);
        showReservationAlert('Erreur de connexion au serveur.', 'danger');
    }
}

// Charger les réservations de l'utilisateur
async function loadReservations() {
    // Afficher le loader
    historyLoader.classList.remove('hidden');
    noReservations.classList.add('hidden');
    historyAlert.classList.add('hidden');
    reservationList.innerHTML = '';
    
    try {
        const response = await fetch(`${API_BASE_URL}/api/user/reservations`, {
            method: 'GET',
            credentials: 'include'
        });
        
        if (response.ok) {
            const reservations = await response.json();
            
            if (reservations.length === 0) {
                // Aucune réservation trouvée
                noReservations.classList.remove('hidden');
            } else {
                // Afficher les réservations
                displayReservations(reservations);
            }
        } else {
            // Erreur lors du chargement des réservations
            showHistoryAlert('Une erreur est survenue lors du chargement des réservations.', 'danger');
        }
    } catch (error) {
        console.error('Erreur lors du chargement des réservations:', error);
        showHistoryAlert('Erreur de connexion au serveur.', 'danger');
    } finally {
        // Masquer le loader
        historyLoader.classList.add('hidden');
    }
}

// Afficher les réservations dans la liste
function displayReservations(reservations) {
    reservationList.innerHTML = '';
    
    // Trier les réservations par date de création (plus récentes en premier)
    reservations.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
    
    reservations.forEach(reservation => {
        const listItem = document.createElement('div');
        listItem.className = 'reservation-item';
        
        // Formater les dates
        const createdDate = new Date(reservation.createdAt).toLocaleDateString('fr-FR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        const statusClass = `status-${reservation.status.toLowerCase()}`;
        const statusText = formatStatus(reservation.status);
        const statusIcon = getStatusIcon(reservation.status);

        // Trouver l'agence correspondante
        let agencyName = "Agence";
        if (reservation.agency) {
            if (typeof reservation.agency === 'object' && reservation.agency.name) {
                // Cas où agency est un objet complet avec une propriété name
                agencyName = reservation.agency.name;
            } else if (typeof reservation.agency === 'number' || typeof reservation.agency === 'string') {
                // Cas où agency est juste un ID
                const agencyId = reservation.agency;
                // Chercher l'agence dans allAgencies si disponible
                if (allAgencies && allAgencies.length > 0) {
                    const foundAgency = allAgencies.find(a => a.id == agencyId);
                    if (foundAgency) {
                        agencyName = foundAgency.name;
                    } else {
                        agencyName = `Agence #${agencyId}`;
                    }
                } else {
                    agencyName = `Agence #${agencyId}`;
                }
            }
        }
        let html = `
            <div class="reservation-header">
                <h3 class="reservation-title">
                    <i class="fas fa-calendar-check"></i>
                    ${reservation.service}
                </h3>
                <span class="reservation-status ${statusClass}">${statusIcon} ${statusText}</span>
            </div>
            
            <div class="reservation-details">
                <div class="reservation-detail">
                    <span class="detail-label">Agence:</span>
                    <span class="detail-value">${agencyName}</span>
                </div>
                <div class="reservation-detail">
                    <span class="detail-label">Créée le:</span>
                    <span class="detail-value">${createdDate}</span>
                </div>
        `;
        
        // Ajouter les dates de début et de fin si elles existent
        if (reservation.startDateTime) {
            const startDate = new Date(reservation.startDateTime).toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            html += `
                <div class="reservation-detail">
                    <span class="detail-label">Date de début:</span>
                    <span class="detail-value">${startDate}</span>
                </div>
            `;
        }
        
        if (reservation.endDateTime) {
            const endDate = new Date(reservation.endDateTime).toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            html += `
                <div class="reservation-detail">
                    <span class="detail-label">Date de fin:</span>
                    <span class="detail-value">${endDate}</span>
                </div>
            `;
        }
        
        if (reservation.preferredDate) {
            // Handle both string format and ISO date format
            let displayDate = reservation.preferredDate;
            if (displayDate.includes('T')) {
                const date = new Date(displayDate);
                displayDate = date.toLocaleDateString('fr-FR') + ' à ' + 
                              date.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'});
            }
            
            html += `
                <div class="reservation-detail">
                    <span class="detail-label">Date souhaitée:</span>
                    <span class="detail-value">${displayDate}</span>
                </div>
            `;
        }
        
        html += `
            </div>
            
            <div class="reservation-description">
                ${reservation.description}
            </div>
        `;
        
        // Vérifier si un feedback existe déjà pour cette réservation
        let hasFeedback = false;
        
        // Ajouter un bouton de feedback pour les réservations complétées
        if (reservation.status === 'COMPLETED') {
            // Vérifier si l'utilisateur a déjà donné un avis
            fetch(`${API_BASE_URL}/api/user/feedback/${reservation.id}/exists`, {
                method: 'GET',
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                const feedbackDiv = document.createElement('div');
                
                if (data.success) {
                    // L'utilisateur a déjà donné un avis
                    feedbackDiv.innerHTML = `
                        <div class="feedback-badge">
                            <i class="fas fa-check-circle"></i> Avis envoyé
                        </div>
                    `;
                    hasFeedback = true;
                } else {
                    // L'utilisateur n'a pas encore donné d'avis
                    feedbackDiv.innerHTML = `
                        <div class="text-right mt-2">
                            <button class="btn btn-info btn-sm add-feedback-btn" data-id="${reservation.id}">
                                <i class="fas fa-star"></i> Donnez votre avis
                            </button>
                        </div>
                    `;
                }
                
                listItem.appendChild(feedbackDiv);
                
                // Ajouter l'écouteur d'événement pour le bouton d'avis
                if (!hasFeedback) {
                    const feedbackBtn = listItem.querySelector('.add-feedback-btn');
                    if (feedbackBtn) {
                        feedbackBtn.addEventListener('click', function() {
                            openFeedbackModal(reservation.id);
                        });
                    }
                }
            })
            .catch(error => {
                console.error('Erreur lors de la vérification du feedback:', error);
            });
        }
        
        // Add cancel button if reservation is in pending status
        if (reservation.status === 'PENDING') {
            html += `
                <div class="text-right mt-2">
                    <button class="btn btn-outline btn-sm cancel-reservation-btn" data-id="${reservation.id}">
                        <i class="fas fa-times"></i> Annuler la demande
                    </button>
                </div>
            `;
        }
        
        listItem.innerHTML = html;
        reservationList.appendChild(listItem);
        
        // Ajouter l'écouteur d'événement pour le bouton d'annulation si nécessaire
        if (reservation.status === 'PENDING') {
            const cancelBtn = listItem.querySelector('.cancel-reservation-btn');
            cancelBtn.addEventListener('click', function() {
                const reservationId = this.getAttribute('data-id');
                showConfirmModal(
                    'Annuler la réservation',
                    'Êtes-vous sûr de vouloir annuler cette demande de réservation ?',
                    () => cancelReservation(reservationId)
                );
            });
        }
    });
}

// Ouvrir le modal de feedback
function openFeedbackModal(reservationId) {
    // Réinitialiser le formulaire
    feedbackForm.reset();
    feedbackAlert.classList.add('hidden');
    
    // Réinitialiser les étoiles
    starButtons.forEach(btn => btn.classList.remove('active'));
    
    // Mettre à jour l'ID de la réservation
    feedbackReservationId.value = reservationId;
    currentFeedbackReservationId = reservationId;
    
    // Afficher le modal
    feedbackModal.style.display = 'block';
}

// Afficher le modal de chargement
function showLoadingModal() {
    document.getElementById('loadingModal').style.display = 'block';
}

// Cacher le modal de chargement
function hideLoadingModal() {
    document.getElementById('loadingModal').style.display = 'none';
}

// Soumettre un feedback
async function submitFeedback() {
    const reservationId = currentFeedbackReservationId;
    const rating = parseInt(ratingInput.value);
    const comment = feedbackComment.value;
    
    // Vérification des champs
    if (!rating || rating < 1 || rating > 5) {
        showAlert(feedbackAlert, 'Veuillez sélectionner une note entre 1 et 5 étoiles.', 'warning');
        return;
    }
    
    // Fermer le modal de feedback
    feedbackModal.style.display = 'none';
    
    // Afficher le modal de chargement
    showLoadingModal();
    
    try {
        const response = await fetch(`${API_BASE_URL}/api/user/feedback`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                reservationId: reservationId,
                rating: rating,
                comment: comment
            }),
            credentials: 'include'
        });
        
        const data = await response.json();
        
        // Cacher le modal de chargement
        hideLoadingModal();
        
        if (response.ok) {
            // Afficher le modal de succès au lieu d'une simple alerte
            showSuccessModal(
                'Merci pour votre avis !',
                'Votre retour est très précieux pour nous et nous aide à améliorer nos services.'
            );
            
            // Recharger les réservations après la fermeture du modal
            successModalBtn.onclick = function() {
                loadReservations(); // Recharger la liste des réservations
                closeAllModals();
            };
        } else {
            showAlert(feedbackAlert, data.message || 'Une erreur est survenue lors de l\'envoi de votre avis.', 'danger');
            feedbackModal.style.display = 'block'; // Réafficher le modal de feedback en cas d'erreur
        }
    } catch (error) {
        console.error('Erreur lors de l\'envoi du feedback:', error);
        hideLoadingModal();
        showAlert(feedbackAlert, 'Erreur de connexion au serveur.', 'danger');
        feedbackModal.style.display = 'block'; // Réafficher le modal de feedback en cas d'erreur
    }
}
// Obtenir l'icône correspondant au statut
function getStatusIcon(status) {
    switch (status) {
        case 'PENDING':
            return '<i class="fas fa-clock"></i>';
        case 'CONFIRMED':
            return '<i class="fas fa-check"></i>';
        case 'CANCELED':
            return '<i class="fas fa-times"></i>';
        case 'COMPLETED':
            return '<i class="fas fa-flag-checkered"></i>';
        default:
            return '';
    }
}

// Annuler une réservation
async function cancelReservation(reservationId) {
    try {
        const response = await fetch(`${API_BASE_URL}/api/user/reservation/cancel/${reservationId}`, {
            method: 'POST',
            credentials: 'include'
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showHistoryAlert('Votre demande de réservation a été annulée avec succès.', 'success');
            loadReservations(); // Recharger la liste des réservations
        } else {
            showHistoryAlert(data.message || 'Erreur lors de l\'annulation de la réservation.', 'danger');
        }
    } catch (error) {
        console.error('Erreur lors de l\'annulation de la réservation:', error);
        showHistoryAlert('Erreur de connexion au serveur.', 'danger');
    }
}

// Formater le statut de la réservation
function formatStatus(status) {
    switch (status) {
        case 'PENDING':
            return 'En attente';
        case 'CONFIRMED':
            return 'Confirmée';
        case 'CANCELED':
            return 'Annulée';
        case 'COMPLETED':
            return 'Terminée';
        default:
            return status;
    }
}

// Charger les informations du profil utilisateur
function loadUserProfile() {
    if (!userData) {
        return;
    }
    
    // Afficher les informations de l'utilisateur
    profileUsername.textContent = userData.username;
    profileEmail.textContent = userData.email;
    
    personalInfoUsername.textContent = userData.username;
    personalInfoEmail.textContent = userData.email;
    
    // Recharger les statistiques utilisateur
    loadUserStats();
}

// Ouvrir le modal de modification du nom d'utilisateur
function openEditUsernameModal() {
    newUsername.value = userData.username;
    editUsernameAlert.classList.add('hidden');
    editUsernameModal.style.display = 'block';
}

// Mettre à jour le nom d'utilisateur
async function updateUsername() {
    const usernameValue = newUsername.value.trim();
    
    if (!usernameValue) {
        showAlert(editUsernameAlert, 'Le nom d\'utilisateur ne peut pas être vide.', 'warning');
        return;
    }
    
    try {
        console.log("Envoi de la requête de mise à jour du nom d'utilisateur");
        const response = await fetch(`${API_BASE_URL}/api/user/update-username`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                username: usernameValue
            }),
            credentials: 'include'
        });
        
        const data = await response.json();
        
        if (response.ok) {
            console.log("Nom d'utilisateur mis à jour avec succès");
            // Mettre à jour les données utilisateur en local
            userData.username = usernameValue;
            
            // Mettre à jour l'interface
            usernameElement.textContent = usernameValue;
            profileUsername.textContent = usernameValue;
            personalInfoUsername.textContent = usernameValue;
            
            // Fermer le modal
            editUsernameModal.style.display = 'none';
            
            // Afficher une notification
            showAlert(profileAlert, 'Nom d\'utilisateur mis à jour avec succès!', 'success');
        } else {
            console.error("Erreur lors de la mise à jour du nom d'utilisateur:", data);
            showAlert(editUsernameAlert, data.message || 'Erreur lors de la mise à jour du nom d\'utilisateur.', 'danger');
        }
    } catch (error) {
        console.error('Erreur lors de la mise à jour du nom d\'utilisateur:', error);
        showAlert(editUsernameAlert, 'Erreur de connexion au serveur.', 'danger');
    }
}

// Changer le mot de passe
async function changePassword() {
    const currentPassword = document.getElementById('currentPassword').value;
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    
    // Vérifier que les mots de passe correspondent
    if (newPassword !== confirmPassword) {
        showAlert(profileAlert, 'Les mots de passe ne correspondent pas.', 'warning');
        return;
    }
    
    try {
        console.log("Envoi de la requête de changement de mot de passe");
        const response = await fetch(`${API_BASE_URL}/api/user/change-password`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                currentPassword: currentPassword,
                newPassword: newPassword
            }),
            credentials: 'include'
        });
        
        const data = await response.json();
        
        if (response.ok) {
            console.log("Mot de passe changé avec succès");
            // Réinitialiser le formulaire
            changePasswordForm.reset();
            
            // Afficher une notification
            showAlert(profileAlert, 'Mot de passe modifié avec succès!', 'success');
        } else {
            console.error("Erreur lors du changement de mot de passe:", data);
            showAlert(profileAlert, data.message || 'Erreur lors de la modification du mot de passe.', 'danger');
        }
    } catch (error) {
        console.error('Erreur lors de la modification du mot de passe:', error);
        showAlert(profileAlert, 'Erreur de connexion au serveur.', 'danger');
    }
}

// Supprimer le compte
async function deleteAccount() {
    const password = document.getElementById('deleteConfirmPassword').value;
    
    try {
        console.log("Envoi de la requête de suppression de compte");
        const response = await fetch(`${API_BASE_URL}/api/user/delete-account`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                password: password
            }),
            credentials: 'include'
        });
        
        const data = await response.json();
        
        if (response.ok) {
            console.log("Compte supprimé avec succès");
            // Rediriger vers la page de connexion
            window.location.href = 'auth.html';
        } else {
            console.error("Erreur lors de la suppression du compte:", data);
            showAlert(profileAlert, data.message || 'Erreur lors de la suppression du compte.', 'danger');
            
            // Fermer le modal de confirmation s'il est ouvert
            closeAllModals();
        }
    } catch (error) {
        console.error('Erreur lors de la suppression du compte:', error);
        showAlert(profileAlert, 'Erreur de connexion au serveur.', 'danger');
        
        // Fermer le modal de confirmation s'il est ouvert
        closeAllModals();
    }
}

// Soumettre le formulaire de contact
async function submitContactForm() {
    const subject = document.getElementById('contactSubject').value;
    const message = document.getElementById('contactMessage').value;
    
    // Vérifier les champs
    if (!subject) {
        showAlert(helpAlert, 'Veuillez sélectionner un sujet.', 'warning');
        return;
    }
    
    if (!message) {
        showAlert(helpAlert, 'Veuillez saisir votre message.', 'warning');
        return;
    }
    
    // Afficher le modal de chargement
    showLoadingModal();
    
    try {
        const response = await fetch(`${API_BASE_URL}/api/user/contact`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                subject,
                message
            }),
            credentials: 'include'
        });
        
        const data = await response.json();
        
        // Cacher le modal de chargement
        hideLoadingModal();
        
        if (response.ok) {
            // Réinitialiser le formulaire
            contactForm.reset();
            
            // Afficher le modal de succès
            showSuccessModal(
                'Message envoyé avec succès !',
                'Votre message a bien été transmis à notre équipe. Nous vous répondrons dans les plus brefs délais.'
            );
        } else {
            showAlert(helpAlert, data.message || 'Erreur lors de l\'envoi du message.', 'danger');
        }
    } catch (error) {
        console.error('Erreur lors de l\'envoi du message:', error);
        hideLoadingModal();
        showAlert(helpAlert, 'Erreur de connexion au serveur.', 'danger');
    }
}
// Afficher le modal de succès
function showSuccessModal(title, message) {
    successMessage.textContent = message;
    successModal.style.display = 'block';
}

// Afficher une alerte dans un conteneur spécifique
function showAlert(container, message, type, autoHide = true) {
    container.className = `alert alert-${type}`;
    
    // Déterminer l'icône en fonction du type
    let icon = '';
    if (type === 'success') icon = '<i class="fas fa-check-circle"></i>';
    else if (type === 'danger') icon = '<i class="fas fa-exclamation-circle"></i>';
    else if (type === 'warning') icon = '<i class="fas fa-exclamation-triangle"></i>';
    else if (type === 'info') icon = '<i class="fas fa-info-circle"></i>';
    
    container.innerHTML = `${icon} ${message}`;
    container.classList.remove('hidden');
    
    // Faire défiler jusqu'à l'alerte
    container.scrollIntoView({ behavior: 'smooth', block: 'start' });
    
    // Masquer l'alerte après 5 secondes si autoHide est true
    if (autoHide) {
        setTimeout(() => {
            container.classList.add('hidden');
        }, 5000);
    }
}

// Afficher une alerte dans la section de réservation
function showReservationAlert(message, type) {
    showAlert(reservationAlert, message, type);
}

// Afficher une alerte dans la section d'historique
function showHistoryAlert(message, type) {
    showAlert(historyAlert, message, type);
}

// Afficher le modal de confirmation
function showConfirmModal(title, message, callback) {
    confirmModalTitle.textContent = title;
    confirmModalMessage.textContent = message;
    
    // Définir la fonction de rappel
    currentConfirmCallback = callback;
    
    // Ajouter l'écouteur d'événement au bouton de confirmation
    confirmModalBtn.onclick = function() {
        if (currentConfirmCallback) {
            currentConfirmCallback();
        }
        confirmModal.style.display = 'none';
    };
    
    // Afficher le modal
    confirmModal.style.display = 'block';
}

// Fermer tous les modals
function closeAllModals() {
    document.querySelectorAll('.modal').forEach(modal => {
        modal.style.display = 'none';
    });
}

// Afficher une section et masquer les autres
function showSection(sectionId) {
    sections.forEach(section => {
        section.classList.add('hidden');
    });
    
    document.getElementById(sectionId).classList.remove('hidden');
    
    // Mettre à jour le menu latéral
    menuItems.forEach(item => {
        if (item.getAttribute('data-section') === sectionId) {
            item.classList.add('active');
        } else {
            item.classList.remove('active');
        }
    });
}

// Déconnexion
async function logout() {
    try {
        // Disconnect any active WebSocket connections
        if (availabilityCalendar.stompClient && availabilityCalendar.stompClient.connected) {
            availabilityCalendar.disconnect();
        }
        
        const response = await fetch(`${API_BASE_URL}/auth/logout`, {
            method: 'POST',
            credentials: 'include'
        });
        
        if (response.ok) {
            // Rediriger vers la page de connexion
            window.location.href = 'auth.html';
        }
    } catch (error) {
        console.error('Erreur lors de la déconnexion:', error);
        // Rediriger quand même vers la page de connexion
        window.location.href = 'auth.html';
    }
}
</script>
</body>
</html>